{% extends "base.html" %}




{% block content %}

    <script>
        function vote(id, type) {


            const upvote_button = document.getElementById(id).children[0];
            const downvote_button = document.getElementById(id).children[2];
            const counter_elem = document.getElementById(id).children[1];

            console.log(counter_elem);


            fetch('/'+(type ? 'upvote' : 'downvote')+'/'+id, {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: {},
            })
            .catch(error => {
                console.error('Error:', error);
            });


            let counter = parseInt(counter_elem.innerHTML);

            if(type) { // if upvote pressed
                counter += upvote_button.classList.contains("upvoted") ? -1 : 1
                if(downvote_button.classList.contains("downvoted")) counter++;

                upvote_button.classList.toggle("upvoted")
                downvote_button.classList.remove("downvoted")
            } else { // if downvote pressed
                counter += downvote_button.classList.contains("downvoted") ? 1 : -1
                if(upvote_button.classList.contains("upvoted")) counter--;

                downvote_button.classList.toggle("downvoted")
                upvote_button.classList.remove("upvoted")
            }
            counter_elem.innerHTML = counter;
            return;
        }

    </script>



    {% for post in posts %}
    <div class="post">
        <div class="header">
            <h2 class="name"><a href="/@{{ post.poster_handle }}">{{ post.poster_display_name }}</a></h2>
            <span class="handle"><a href="/@{{ post.poster_handle }}">@{{ post.poster_handle }}</a></span>
            <span class="posted">{{ post.post_date }}</span>
        </div>
        <img class="image" loading="lazy" src="{{ post.image_url }}">
        <div class="body">
            <div>
            <p class="location">seen in: {{ post.city }}, {{ post.state_name }} (<a target="_blank" href="https://www.google.com/maps?q={{ post.latitude }},{{ post.longitude }}">{{ post.latitude }},{{ post.longitude }}</a>)</p>
            <p class="spotted">spotted: {{ post.sighting_date }} at {{ post.sighting_time }} ({{ post.duration }})</p>
            <p class="description">{{ post.content }}</p>
            </div>
            <div id="{{ post.id }}" class="vote">
                <p onclick="vote('{{ post.id }}', 1)">+1</p>
                <p class="count">23</p>
                <p onclick="vote('{{ post.id }}', 0)">-1</p>
            </div>
        </div>
    </div>
    <hr>
    {% endfor %}
{% endblock %}




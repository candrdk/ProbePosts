{% extends "base.html" %}

{% block content %}

    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script type="text/javascript">
        $(document).ready(function() {
            $('.vote').click(function(ev) {
                var vote_type = $(ev.currentTarget).attr('vote-type');
                var post_id = $(ev.currentTarget).attr('post-id');

                $.get('/' + vote_type + '/' + post_id, function(data) {
                    $('.karma').text(data['karma']);
                    $('#' + post_id + ' .vote').each(function() {
                        var $thisVote = $(this);
                        if ($thisVote.attr('vote-type') === 'upvote') {
                            if (data['rating'] == null) {
                                $thisVote.text("⬆️");
                            }
                            else {
                                $thisVote.text(data['rating'] ? "✅" : "⬆️");
                            }
                        } else if ($thisVote.attr('vote-type') === 'downvote') {
                            if (data['rating'] == null) {
                                $thisVote.text("⬇️");
                            }
                            else {
                                $thisVote.text(data['rating'] ? "⬇️" : "❌");
                            }
                        }
                    });
                });
            });
        });
    </script>

    {% for post in posts %}
    <div class="post">
        <div class="header">
            <h2 class="name"><a href="/@{{ post.poster_handle }}">{{ post.poster_display_name }}</a></h2>
            <span class="handle"><a href="/@{{ post.poster_handle }}">@{{ post.poster_handle }}</a></span>
            <span class="posted">{{ post.post_date }}</span>
        </div>

        <img class="image" loading="lazy" src="{{ post.image_url }}">

        <div class="body">
            <div>
            <p class="location">seen in: {{ post.city }}, {{ post.state_name }} (<a target="_blank" href="https://www.google.com/maps?q={{ post.latitude }},{{ post.longitude }}">{{ post.latitude }},{{ post.longitude }}</a>)</p>
            <p class="spotted">spotted: {{ post.sighting_date }} at {{ post.sighting_time }} ({{ post.duration }})</p>
            <p class="description">{{ post.content }}</p>
            </div>
            <div id="{{ post.id }}" class="rating">
                <p class="vote"  vote-type="upvote" post-id="{{ post.id }}">⬆️</p>
                <p class="karma" style="text-align: center;">{{ post.karma }}</p>
                <p class="vote"  vote-type="downvote" post-id="{{ post.id }}">⬇️</p>
            </div>
        </div>
    </div>
    <hr>
    {% endfor %}
{% endblock %}



